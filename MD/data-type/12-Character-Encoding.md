## 字符集（charset）

世界上存在着多种编码方式，同一个二进制数字可以被解释成不同的符号。因此，要想打开一个文本文件，就必须知道它的编码方式，否则用错误的编码方式解读，就会出现乱码。

### ASCII 码

计算机内部所有信息都是一个二进制值。每一个二进制位（bit）有 `0` 和 `1` 两种状态，因此八个二进制位就可以组合出 256 种状态，这被称为一个字节（byte）。也就是说，一个字节一共可以用来表示 256 种不同的状态，每一个状态对应一个符号，就是 256 个符号，从 `00000000` 到 `11111111`。

上个世纪 60 年代，美国制定了一套字符编码，对英语字符与二进制位之间的关系，做了统一规定。这被称为 ASCII 码，一直沿用至今。

ASCII 码一共规定了 128 个字符的编码，比如空格 SPACE 是 32（二进制 00100000），大写的字母 A 是 65（二进制 01000001）。这 128 个符号（包括 32 个不能打印出来的控制符号），只占用了一个字节的后面 7 位，最前面的一位统一规定为 0。

常见 ASCII 码的大小规则：`0~9 < A~Z < a~z`。

### 非 ASCII 编码

英语用128个符号编码就够了，但是用来表示其他语言，128 个符号是不够的。因此不同国家对剩余的 128-255 进行了不同的编码规定。

所有这些编码方式中，0-127 表示的符号是一样的，不一样的只是 128-255 的这一段。

至于亚洲国家的文字，使用的符号就更多了，汉字就多达 10 万左右。一个字节只能表示 256 种符号，肯定是不够的，就必须使用多个字节表达一个符号。比如，简体中文常见的编码方式是 GB2312，使用两个字节表示一个汉字，所以理论上最多可以表示 256 x 256 = 65536 个符号。

### Unicode 编码

Unicode 是统一字符编码标准，世界上所有的符号都可纳入其中，每一个符号都给予一个独一无二的编码。

它从 0 开始，为每个符号指定一个编号（十六进制数），这叫做"码点"（code point）。需要注意的是，Unicode 只是一个符号集，它只规定了符号的码点，却没有规定这个码点应该如何存储。如 `U+0000`，其中 `U+` 表示紧跟在后面的十六进制数是 Unicode 的码点。

Unicode 编码系统，可分为编码方式和实现方式两个层次。

### UTF-8

UTF-8 就是在互联网上使用最广的一种 Unicode 的实现方式。其他实现方式还包括 UTF-16（字符用两个字节或四个字节表示）和 UTF-32（字符用四个字节表示），不过在互联网上基本不用。重复一遍，这里的关系是，UTF-8 是 Unicode 的实现方式之一。

UTF-8 最大的一个特点，就是它是一种变长的编码方式。它可以使用 1~4 个字节表示一个符号，根据不同的符号而变化字节长度。

### JavaScript 的 Unicode 转换

### 码点表示法

JavaScript 允许直接用码点表示 Unicode 字符，写法是 `\u码点`。但是，这种表示法对 4 字节的码点无效。ES6 修正了这个问题，只要将码点放在大括号内，就能正确识别，即 `\u{码点}`。

- `\u码点`：表示 2 个字节的编码，即 `U+0000` 到 `U+FFFF` 的 Unicode 编码。

- `\u{码点}`：码点可为任意字符的的十六进制数。可正确表示 4 个字节的编码，即 `U+010000` 到 `U+10FFFF` 的 Unicode 编码。

```js
'\u007A' === 'z' // true
'\u{7A}' === 'z' // true
```

### 字符串处理函数

- `String.fromCharCode()`：参数是一个或多个数值，代表 Unicode 码点，返回值是这些码点组成的字符串。不支持 Unicode 码点大于 `0xFFFF` 的字符。

- `String.fromCodePoint()`：从 Unicode 码点返回对应字符，可正确处理码点大于 `0xFFFF` 的字符。

- `String.prototype.codePointAt()`：从字符返回对应的码点，码点为十进制表示。能够正确处理码点大于 `0xFFFF `的字符。

- `String.prototype.charCodeAt()`：返回字符串给定位置的字符码点（十进制表示），不能正确返回 Unicode 码点大于 `0xFFFF` 的字符。

## base64 编码

base64 是一种编码方法，可以将任意值转成 `0～9`、`A～Z`、`a-z`、`+` 和 `/` 64 个字符组成的可打印字符。使用它的主要目的，不是为了加密，而是为了不出现特殊字符，简化程序的处理。

### 转码方法

#### ASCII 码的字符

- `btoa(x)`：可将任意值转为 Base64 编码，返回 Base64 字符串。

- `atob(str)`：Base64 编码转为原来的值，返回原值的字符串形式。

#### 非 ASCII 码字符

转码时可先通过 `encodeURIComponent(str)` 转码特殊符号和特殊字符，解码之后再通过 `decodeURIComponent()` 解码。

```js
function b64Encode(str) {
  return btoa(encodeURIComponent(str));
}
function b64Decode(str) {
  return decodeURIComponent(atob(str));
}
```

参考链接：
 [*Unicode*](https://home.unicode.org/)
 [*字符编码笔记*](http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html)
 [*Unicode与JavaScript详解*](http://www.ruanyifeng.com/blog/2014/12/unicode.html)
